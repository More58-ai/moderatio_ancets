<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FART UA | Cyber Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { 
            --ua-blue: #0057b7; 
            --ua-yellow: #ffd700; 
            --accent: #00f2ff;
            --bg: #01060b; 
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Montserrat', sans-serif; background: var(--bg); color: white; 
            min-height: 100vh; overflow-x: hidden;
        }

        /* Фоновий ефект */
        #snow-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1; opacity: 0.5; }
        .bg-glow {
            position: fixed; width: 400px; height: 400px; background: var(--ua-blue);
            filter: blur(150px); border-radius: 50%; opacity: 0.15; z-index: 0; top: -100px; left: -100px;
        }

        .admin-wrapper { position: relative; z-index: 10; padding: 40px 20px; max-width: 1400px; margin: 0 auto; }

        .dashboard-header {
            text-align: center; margin-bottom: 60px;
        }
        .dashboard-header h1 { 
            font-size: 3rem; font-weight: 900; letter-spacing: 10px; 
            background: linear-gradient(to right, #fff, var(--ua-yellow));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-transform: uppercase;
        }
        .stats-bar {
            display: inline-flex; gap: 30px; background: rgba(255,255,255,0.05);
            padding: 10px 30px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1);
            margin-top: 20px; backdrop-filter: blur(10px);
        }

        /* Сітка карток */
        #apps-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }

        .card {
            background: rgba(15, 25, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 30px;
            position: relative;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            backdrop-filter: blur(12px);
            overflow: hidden;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, transparent, rgba(0, 242, 255, 0.05));
            pointer-events: none;
        }
        .card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--ua-yellow);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .card-id { font-size: 0.7rem; color: var(--accent); letter-spacing: 2px; }
        .card-name { font-size: 1.4rem; font-weight: 800; margin: 10px 0; }
        
        .card-info { font-size: 0.85rem; opacity: 0.7; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .card-info i { color: var(--ua-yellow); width: 15px; }

        .btn-view {
            width: 100%; margin-top: 20px; padding: 12px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white;
            font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .btn-view:hover { background: var(--ua-blue); border-color: var(--ua-blue); }

        /* Модальне вікно (Glass) */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            z-index: 100; display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-content {
            background: linear-gradient(145deg, #0a1422, #050b14);
            width: 100%; max-width: 700px; border-radius: 30px; border: 1px solid var(--ua-yellow);
            padding: 40px; position: relative; max-height: 90vh; overflow-y: auto;
        }
        .modal-close { position: absolute; top: 20px; right: 25px; font-size: 2rem; cursor: pointer; color: var(--ua-yellow); }

        .answer-box { background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin-top: 15px; border-left: 3px solid var(--ua-blue); }
        .answer-box h4 { font-size: 0.75rem; color: var(--ua-yellow); text-transform: uppercase; margin-bottom: 8px; letter-spacing: 1px; }

    </style>
</head>
<body>

<div class="bg-glow"></div>
<canvas id="snow-canvas"></canvas>

<audio id="notifySound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

<div class="admin-wrapper">
    <div class="dashboard-header">
        <h1 class="animate__animated animate__fadeInDown">FART UA COMMAND</h1>
        <div class="stats-bar">
            <span><i class="fas fa-users"></i> Заявок: <b id="total-count">0</b></span>
            <span><i class="fas fa-clock"></i> Live Update: <b style="color:#00ff00">ON</b></span>
        </div>
    </div>

    <div id="apps-grid">
        </div>
</div>

<div class="modal-overlay" id="overlay">
    <div class="modal-content animate__animated animate__zoomIn">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <div id="modal-data"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "ВАШ_API",
        authDomain: "uz-tickets-2dcb8.firebaseapp.com",
        databaseURL: "https://uz-tickets-2dcb8-default-rtdb.firebaseio.com",
        projectId: "uz-tickets-2dcb8",
        storageBucket: "uz-tickets-2dcb8.appspot.com",
        messagingSenderId: "SENDER_ID",
        appId: "APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let firstLoad = true;

    const grid = document.getElementById('apps-grid');
    const totalCount = document.getElementById('total-count');
    const sound = document.getElementById('notifySound');

    onValue(ref(db, 'applications/moderators/'), (snapshot) => {
        grid.innerHTML = "";
        let count = 0;
        const data = snapshot.val();

        if (data) {
            Object.keys(data).forEach(date => {
                const dayData = data[date];
                Object.keys(dayData).forEach(key => {
                    count++;
                    const app = dayData[key];
                    renderCard(app);
                });
            });

            // Звук при новій заявці (якщо це не перше завантаження)
            if (!firstLoad) sound.play();
            firstLoad = false;
        }
        totalCount.innerText = count;
    });

    function renderCard(app) {
        const div = document.createElement('div');
        div.className = "card animate__animated animate__fadeInUp";
        div.innerHTML = `
            <div class="card-header">
                <span class="card-id">${app.SystemInfo.applicationID}</span>
                <i class="fas fa-circle" style="color:#00ff00; font-size:0.5rem"></i>
            </div>
            <h2 class="card-name">${app.Identity.fullName}</h2>
            <div class="card-info"><i class="fab fa-discord"></i> ${app.Contacts.discord}</div>
            <div class="card-info"><i class="fas fa-map-marker-alt"></i> ${app.Identity.residence}</div>
            <div class="card-info"><i class="fas fa-clock"></i> ${app.SystemInfo.submittedAt}</div>
            <button class="btn-view" onclick='showFull("${encodeURIComponent(JSON.stringify(app))}")'>Переглянути анкету</button>
        `;
        grid.prepend(div);
    }

    window.showFull = (encoded) => {
        const app = JSON.parse(decodeURIComponent(encoded));
        const modalData = document.getElementById('modal-data');
        modalData.innerHTML = `
            <h2 style="font-size:2rem; margin-bottom:5px;">${app.Identity.fullName}</h2>
            <p style="color:var(--accent)">${app.Contacts.discord} • ${app.Contacts.telegram}</p>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:30px">
                <div class="answer-box"><h4>Місто</h4>${app.Identity.residence}</div>
                <div class="answer-box"><h4>Час на проект</h4>${app.Experience.timeCommitment}</div>
            </div>
            
            <div class="answer-box"><h4>Досвід модерації</h4>${app.Experience.history}</div>
            <div class="answer-box"><h4>Алгоритм при рейді</h4>${app.ModerationTest.raidResponse}</div>
            <div class="answer-box"><h4>Друзі та правила</h4>${app.ModerationTest.conflictManagement}</div>
            <div class="answer-box"><h4>Токсична поведінка</h4>${app.ModerationTest.toxicBehaviorLogic}</div>
            <div class="answer-box"><h4>Психологія модератора</h4>${app.Psychology.unacceptableActions}</div>
            
            <p style="margin-top:20px; font-size:0.7rem; opacity:0.3">IP: ${app.Contacts.userIP} | Дата: ${app.SystemInfo.submittedAt}</p>
        `;
        document.getElementById('overlay').style.display = 'flex';
    };

    window.closeModal = () => document.getElementById('overlay').style.display = 'none';
</script>

<script>
    // Оптимізований сніг
    const canvas = document.getElementById('snow-canvas');
    const ctx = canvas.getContext('2d');
    let w, h, p = [];
    function init() {
        w = window.innerWidth; h = window.innerHeight;
        canvas.width = w; canvas.height = h;
        p = Array.from({length: 60}, () => ({x: Math.random()*w, y: Math.random()*h, r: Math.random()*2+1, s: Math.random()*0.5+0.2}));
    }
    function draw() {
        ctx.clearRect(0,0,w,h); ctx.fillStyle = "white"; ctx.beginPath();
        p.forEach(i => { ctx.moveTo(i.x, i.y); ctx.arc(i.x, i.y, i.r, 0, Math.PI*2); });
        ctx.fill();
        p.forEach(i => { i.y += i.s; if(i.y > h) i.y = -5; });
        requestAnimationFrame(draw);
    }
    init(); draw(); window.onresize = init;
</script>

</body>
</html>
